"use strict";var Bots=Bots||{};Bots.AnimatedSprite=function(t,e,s,i){var o=this;Bots.Prefab.call(this,t,e,s,i),(i.animations||[]).forEach(function(t){o.animations.add(t.name,i.frames,i.frameRate,i.loop,i.killOnComplete)})},Bots.AnimatedSprite.prototype=Object.create(Bots.Prefab.prototype),Bots.AnimatedSprite.prototype.constructor=Bots.AnimatedSprite,Bots.AnimatedSprite.prototype.play=function(t){var e=this.properties.animations.filter(function(e){return e.name===t})[0];e&&this.animations.play(e.name,e.frameRate,e.loop,e.killOnComplete)},Bots.Button=function(t,e,s,i){Bots.Prefab.call(this,t,e,s,i),this.fixedToCamera=!0,this.inputEnabled=!0,this.input.priorityId=999,this.input.useHandCursor=!0,this.events.onInputDown.add(this.onButtonPressed,this),this.events.onInputUp.add(this.onButtonReleased,this),this.shadow=this.game.add.sprite(this.x,this.y+2,this.properties.key),this.shadow.tint=0,this.shadow.anchor.setTo(.5),this.shadow.fixedToCamera=!0,this.state.groups.hud.addAt(this.shadow,0)},Bots.Button.prototype=Object.create(Bots.Prefab.prototype),Bots.Button.prototype.constructor=Bots.Button,Bots.Button.prototype.onButtonPressed=function(){this.game.paused&&!this.properties.force||(this.scale.setTo(1.1),this.shadow.scale.setTo(1.1))},Bots.Button.prototype.onButtonReleased=function(){this.game.paused&&!this.properties.force||(this.scale.setTo(1),this.shadow.scale.setTo(1),Bots.soundsEnabled&&this.state.prefabs.clickSound.safelyPlay(),this.state.onButtonPressed(this))},Bots.Chest=function(t,e,s,i){Bots.Droppable.call(this,t,e,s,i),this.scale.setTo(Bots.scale),this.anchor.setTo(.5),this.angle=this.game.rnd.integerInRange(0,360),this.shadow=this.game.add.sprite(this.x,this.y,i.key),this.shadow.scale.x=1.3*this.scale.x,this.shadow.scale.y=1.3*this.scale.y,this.shadow.alpha=.25,this.shadow.anchor.setTo(.5),this.shadow.tint=0,this.shadow.name=e+"_shadow",this.shadow.angle=this.angle,this.state.groups.shadows.add(this.shadow)},Bots.Chest.prototype=Object.create(Bots.Droppable.prototype),Bots.Chest.prototype.constructor=Bots.Chest,Bots.Chest.prototype.initializeObject=function(){this.game.physics.enable(this,Phaser.Physics.ARCADE),this.body.immovable=!0},Bots.Chest.prototype.hit=function(){return this.properties.lifePoints-=1,this.properties.lifePoints<=0},Bots.Control=function(t,e,s,i){var o=this;Bots.Prefab.call(this,t,e,s,i),this.isPressed=!1,this.inputEnabled=!0,this.events.onInputDown.add(function(){return o.isPressed=!0},this),this.events.onInputUp.add(function(){o.isPressed=!1},this)},Bots.Control.prototype=Object.create(Bots.Prefab.prototype),Bots.Control.prototype.constructor=Bots.Control,Bots.CreditsItem=function(t,e,s,i){var o=this;Bots.Prefab.call(this,t,e,s,i);this.graphics=this.game.add.graphics(0,0),this.addChild(this.graphics),this.sprite=this.game.add.sprite(0,0,i.dummyKey),this.sprite.anchor.setTo(.5);var a=.4*this.properties.size.width/this.sprite.width,r=.4*this.properties.size.height/this.sprite.height;this.sprite.scale.setTo(a<r?a:r),this.sprite.x=-this.properties.size.width/2+this.sprite.width/2+8,this.addChild(this.sprite),this.caption=this.game.add.text(this.sprite.x+this.sprite.width/2+8,this.sprite.y-this.sprite.height/2,shortenName(i.title,15),this.captionTextStyle()),this.addChild(this.caption),this.author=this.game.add.text(this.sprite.x+this.sprite.width/2+8,this.sprite.y-this.sprite.height/2+16,"by "+shortenName(i.author,12),this.regularTextStyle()),this.addChild(this.author),this.linkIcon=this.game.add.sprite(this.properties.size.width/2-8,this.properties.size.height/2-8,"uiLink"),this.linkIcon.anchor.setTo(1),this.addChild(this.linkIcon),this.linkIcon.inputEnabled=!0,this.linkIcon.events.onInputUp.add(function(){if(o.game.device.iPad)location.href=i.link;else{var t=window.open(i.link,"_blank");t?t.focus():location.href=i.link}},this)},Bots.CreditsItem.prototype=Object.create(Bots.Prefab.prototype),Bots.CreditsItem.prototype.constructor=Bots.CreditsItem,Bots.CreditsItem.prototype.update=function(){this.graphics.clear(),this.graphics.beginFill(0,.5),this.graphics.drawRect(-this.properties.size.width/2,-this.properties.size.height/2,this.properties.size.width,this.properties.size.height),this.graphics.endFill()},Bots.CreditsItem.prototype.captionTextStyle=function(){return{font:"10pt bold Helvetica, sans-serif",fill:"#ffffff",align:"left"}},Bots.CreditsItem.prototype.regularTextStyle=function(){return{font:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:8)+"pt Helvetica, sans-serif",fill:"#ffffff",align:"left"}},Bots.Dust=function(t,e,s,i){Bots.Prefab.call(this,t,e,s,i),this.game.add.tween(this).to({alpha:0},5e3,Phaser.Easing.Quartic.In,!0).onComplete.add(function(){this.kill(),this.destroy(),this.state.groups[this.properties.group].remove(this)},this)},Bots.Dust.prototype=Object.create(Bots.Prefab.prototype),Bots.Dust.prototype.constructor=Bots.Dust,Bots.Explosion=function(t,e,s,i){Bots.Prefab.call(this,t,e,s,i);this.animations.add("explosion");this.animations.play("explosion",25,!1,!0)},Bots.Explosion.prototype=Object.create(Bots.Prefab.prototype),Bots.Explosion.prototype.constructor=Bots.Explosion,Bots.Loot=function(t,e,s,i){if(Bots.Prefab.call(this,t,e,s,i),this.properties.robot.properties[this.properties.type]+=this.properties.amount,this.properties.robot.properties[this.properties.type]>this.properties.maxValue&&(this.properties.robot.properties[this.properties.type]=this.properties.maxValue),"speed"===this.properties.type&&this.properties.robot.applySpeedIncrease(),this.properties.robot.human){var o=this.properties.amount>=0?"#00ff00":"#ff0000";this.game.time.events.add(0,function(){getMemberByName(this.state.groups.hud,this.properties.hudTextName).addColor(o,0),this.game.time.events.add(250,function(){getMemberByName(this.state.groups.hud,this.properties.hudTextName).addColor("#ffffff",0)},this)},this),getMemberByName(this.state.groups.hud,this.properties.hudTextName).text=this.properties.robot.properties[this.properties.type]}this.game.add.tween(this).to({y:s.y-150,alpha:0},1e3,Phaser.Easing.Quadratic.Out,!0),this.game.add.tween(this.scale).to({x:4,y:4},1e3,Phaser.Easing.Quadratic.Out,!0).onComplete.add(function(){this.kill(),this.destroy(),this.state.groups.loot.remove(this)},this)},Bots.Loot.prototype=Object.create(Bots.Prefab.prototype),Bots.Loot.prototype.constructor=Bots.Loot,Bots.MenuRobot=function(t,e,s,i){Bots.Prefab.call(this,t,e,s,i),this.anchor.setTo(.5),this.scale.setTo(Bots.scale),this.currentDestination=null,this.game.physics.enable(this,Phaser.Physics.ARCADE),this.body.maxVelocity.setTo(100),this.currentSpeed=this.game.rnd.integerInRange(50,100),this.body.mass=1,this.speedMultiplier=1,this.shadow=this.game.add.sprite(this.x,this.y,i.key),this.shadow.scale.x=1.2*this.scale.x,this.shadow.scale.y=1.2*this.scale.y,this.shadow.alpha=.25,this.shadow.anchor.setTo(.5),this.shadow.tint=0,this.shadow.name=e+"_shadow",this.state.groups.shadows.add(this.shadow)},Bots.MenuRobot.prototype=Object.create(Bots.Prefab.prototype),Bots.MenuRobot.prototype.constructor=Bots.MenuRobot,Bots.MenuRobot.prototype.reset=function(t,e){Bots.Prefab.prototype.reset.call(this,t,e)},Bots.MenuRobot.prototype.update=function(){this.speedMultiplier=1,this.shadow.x=this.x,this.shadow.y=this.y,this.shadow.angle=this.angle,(!this.currentDestination||this.game.physics.arcade.distanceToXY(this,this.currentDestination.x,this.currentDestination.y)<=50)&&(this.currentDestination=new Phaser.Point(randomInteger(2*Bots.screenSize.x)-Bots.screenSize.x/2,randomInteger(2*Bots.screenSize.y)-Bots.screenSize.y/2)),this.currentDestination&&(this.rotation=this.game.physics.arcade.angleToXY(this,this.currentDestination.x,this.currentDestination.y,!0),this.game.physics.arcade.moveToObject(this,this.currentDestination,this.currentSpeed))},Bots.MessagePrefab=function(t,e,s,i){var o=this;this.messageHeight=36,Phaser.Graphics.call(this,t.game,Bots.screenSize.x/2,100,i.text,i.style),this.state=t,this.name=e,this.properties=i,this.state.prefabs[e]=this,this.game=t.game,this.anchor.setTo(.5),this.fixedToCamera=!0,i.group&&this.state.groups[i.group].add(this),this.beginFill(0,.75),this.drawRect(-Bots.screenSize.x/2,-this.messageHeight/2,Bots.screenSize.x,this.messageHeight),this.endFill(),this.text=this.game.add.text(0,2,i.text,i.style),this.text.anchor.setTo(.5),this.addChild(this.text),this.sprite=this.game.add.sprite(0,0,i.key),this.sprite.anchor.setTo(.5),this.sprite.scale.setTo(i.imageScale.x,i.imageScale.y),this.addChild(this.sprite),this.sprite.x=-this.text.width/2-this.sprite.width/2-8,this.game.time.events.add(2e3,function(){o.game.add.tween(o).to({alpha:0},3e3,Phaser.Easing.Quadratic.Out,!0).onComplete.add(function(){killFromGroup(o,o.state.groups[i.group])},o)},this)},Bots.MessagePrefab.prototype=Object.create(Phaser.Graphics.prototype),Bots.MessagePrefab.prototype.constructor=Bots.MessagePrefab,Bots.MessagePrefab.prototype.autoSize=function(t,e){if(this.defaultFontSize||(this.defaultFontSize=this.fontSize),t>0&&e>0){this.fontSize=64;for(var s=this.fontSize;this.fontSize>4;){if(this.width<t&&this.height<e)return s;this.fontSize=--s}}},Bots.Meteorit=function(t,e,s,i){Bots.Droppable.call(this,t,e,s,i),this.scale.setTo(Bots.scale),this.anchor.setTo(.5),this.angle=this.game.rnd.integerInRange(0,360)},Bots.Meteorit.prototype=Object.create(Bots.Droppable.prototype),Bots.Meteorit.prototype.constructor=Bots.Meteorit,Bots.Meteorit.prototype.initializeObject=function(){var t=this;this.game.physics.enable(this,Phaser.Physics.ARCADE),this.body.immovable=!0,getMemberByName(this.state.groups.spawners,"explosionSpawner").spawn(this),getMemberByName(this.state.groups.spawners,"dustSpawner").spawn(this),getMemberByName(this.state.groups.spawners,"earthQuakeSpawner").spawn(this,this.game.rnd.integerInRange(0,10));var e=this.getBounds();this.state.groups.robots.forEachAlive(function(s){s.isDead||s.boss||!Phaser.Rectangle.intersects(e,s.getBounds())||s.dealDamage(calculateDamage2(t.properties.attack,s.properties.defense))&&getMemberByName(t.state.groups.spawners,"textSpawner").spawn(s.properties.displayName+" ("+s.killCounter.text+") was killed by a comet")}),killFromGroup(this,this.state.groups[this.properties.group])},Bots.Oil=function(t,e,s,i){var o=this;Bots.Prefab.call(this,t,e,s,i),this.game.physics.enable(this,Phaser.Physics.ARCADE),this.game.add.tween(this).to({alpha:0},2e4,Phaser.Easing.Quartic.In,!0).onComplete.add(function(){return killFromGroup(o,o.state.groups[o.properties.group])},this)},Bots.Oil.prototype=Object.create(Bots.Prefab.prototype),Bots.Oil.prototype.constructor=Bots.Oil,Bots.SelectableSprite=function(t,e,s,i){var o=this;Bots.Prefab.call(this,t,e,s,i),this.isSelected=!1,this.frameGraphic=this.game.add.graphics(0,0),this.addChild(this.frameGraphic),this.inputEnabled=!0,this.events.onInputUp.add(function(){o.game.paused&&!o.properties.force||(Bots.soundsEnabled&&o.state.prefabs.clickSound.safelyPlay(),o.isSelected=!0,i.parent.onTileSelected(o))},this),this.game.physics.enable(this,Phaser.Physics.ARCADE),this.properties.shadow&&(this.shadowGraphic=this.game.add.graphics(0,0),this.state.groups[i.group].addAt(this.shadowGraphic,0))},Bots.SelectableSprite.prototype=Object.create(Bots.Prefab.prototype),Bots.SelectableSprite.prototype.constructor=Bots.SelectableSprite,Bots.SelectableSprite.prototype.update=function(){this.frameGraphic.clear(),this.properties.shadow&&(this.shadowGraphic.clear(),this.shadowGraphic.beginFill(0),this.shadowGraphic.drawRect(this.x-this.width*this.scale.x+2,this.y-this.height*this.scale.y+2,this.width,this.height),this.shadowGraphic.endFill()),this.frameGraphic.lineStyle(1,0,1),this.frameGraphic.beginFill(0,this.isSelected?0:.25),this.frameGraphic.drawRect(-this.width/2/this.scale.x,-this.height/2/this.scale.y,this.width/this.scale.x,this.height/this.scale.y),this.frameGraphic.endFill()},Bots.Smoke=function(t,e,s,i){var o=this;Bots.Prefab.call(this,t,e,s,i);var a=this.scale;this.game.physics.enable(this,Phaser.Physics.ARCADE),this.game.add.tween(this.scale).to({x:3*a.x,y:3*a.y},5e3,Phaser.Easing.Quartic.In,!0),this.game.add.tween(this).to({alpha:0},3e3,Phaser.Easing.Quartic.In,!0).onComplete.add(function(){return killFromGroup(o,o.state.groups[o.properties.group])},this)},Bots.Smoke.prototype=Object.create(Bots.Prefab.prototype),Bots.Smoke.prototype.constructor=Bots.Smoke,Bots.TextPrefab=function(t,e,s,i){Phaser.Text.call(this,t.game,s.x,s.y,i.text,i.style),this.state=t,this.name=e,this.properties=i,this.state.prefabs[e]=this,this.game=t.game,i.group&&this.state.groups[i.group].add(this),i.anchor&&this.anchor.setTo(i.anchor.x,i.anchor.y),i.scale&&this.scale.setTo(i.scale.x,i.scale.y),i.alpha&&(this.alpha=i.alpha),this.fixedToCamera=i.fixedToCamera,i.size&&this.autoSize(i.size.width,i.size.height),i.lineSpacing&&(this.lineSpacing=i.lineSpacing),i.shadow&&this.setShadow(2,2,"rgba(0,0,0,0.5)",0)},Bots.TextPrefab.prototype=Object.create(Phaser.Text.prototype),Bots.TextPrefab.prototype.constructor=Bots.TextPrefab,Bots.TextPrefab.prototype.autoSize=function(t,e){if(this.defaultFontSize||(this.defaultFontSize=this.fontSize),t>0&&e>0){this.fontSize=64;for(var s=this.fontSize;this.fontSize>4;){if(this.width<t&&this.height<e)return s;this.fontSize=--s}}},Bots.TileSprite=function(t,e,s,i){Phaser.TileSprite.call(this,t.game,s.x,s.y,i.size.width,i.size.height,i.key),this.state=t,this.name=e,this.properties=i,this.state.prefabs[e]=this,this.fixedToCamera=!!i.fixedToCamera,i.group&&this.state.groups[i.group].add(this),i.frame&&(this.frame=i.frame),i.anchor&&this.anchor.setTo(i.anchor.x,i.anchor.y)},Bots.TileSprite.prototype=Object.create(Phaser.TileSprite.prototype),Bots.TileSprite.prototype.constructor=Bots.TileSprite,Bots.TileSprite.prototype.update=function(){this.properties.fixedToCamera&&(this.tilePosition.x=-this.game.camera.x,this.tilePosition.y=-this.game.camera.y)},Bots.Track=function(t,e,s,i){Bots.Prefab.call(this,t,e,s,i),this.game.add.tween(this).to({alpha:0},1e3,Phaser.Easing.Quartic.In,!0).onComplete.add(function(){this.kill(),this.destroy(),this.state.groups[this.properties.group].remove(this)},this)},Bots.Track.prototype=Object.create(Bots.Prefab.prototype),Bots.Track.prototype.constructor=Bots.Track;